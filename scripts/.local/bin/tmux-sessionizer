#!/bin/bash

if [[ $# -eq 1 ]]; then
  WORK_DIR="$1"
else
  WORK_DIR=$(find ~/code ~/code/practice -mindepth 1 -maxdepth 2 -type d ! -path '*/.*' ! -path '*/.*/**' | sort -u | fzf)
fi
[[ -z "$WORK_DIR" ]] && echo "No directory selected" >&2 && exit 1

SESSION_NAME=$(basename "$WORK_DIR")
tmux has-session -t "$SESSION_NAME" 2>/dev/null || tmux new -ds "$SESSION_NAME" -c "$WORK_DIR"
[[ -z "$TMUX" ]] && tmux attach -t "$SESSION_NAME" || tmux switch -t "$SESSION_NAME"
